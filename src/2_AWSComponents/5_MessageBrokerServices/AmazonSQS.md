# Amazon SQS (Simple Queue Service)
- [Amazon SQS (Simple Queue Service)](https://aws.amazon.com/sqs/) is a fully managed message queuing service that enables you to [decouple and scale microservices](../../1_HLDDesignComponents/1_MicroServicesSOA/Readme.md), [distributed systems](../../1_HLDDesignComponents/0_SystemGlossaries/Readme.md), and [serverless applications](../AWS-Serverless-Architecture.md).

![img.png](assests/sns/FanOutPatternSQSSNS.png)

# Key Features

| Feature                                                                                                                               | Descriptions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| star: [Amazon SQS vs others](../../1_HLDDesignComponents/4_MessageBrokers/KafkaVsRabbitMQVsSQSVsSNS.md)                               | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Highly Available                                                                                                                      | [Amazon SQS]() is [highly available](../../1_HLDDesignComponents/0_SystemGlossaries/Reliability/HighAvailability.md), by default.                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| [MessageGroupId](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/using-messagegroupid-property.html)       | [MessageGroupId](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_SendMessage.html) is the tag that specifies that a message belongs to a specific message group. <br/>- Messages that belong to the same message group are always processed one by one, in a strict order relative to the message group (however, messages that belong to different message groups might be processed out of order).                                                                                                                                           |
| At-least-Once delivery                                                                                                                | Unlike a [publish-subscribe system](../../1_HLDDesignComponents/4_MessageBrokers/Readme.md), a single message should be delivered to a single consumer, even when there are a lot of consumers running concurrently (also known as the [competing consumers pattern](https://www.conceptdraw.com/examples/message-queue)).                                                                                                                                                                                                                                               |
| [Dead-Letter Queue](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html)           | [Amazon SQS]() supports [dead-letter queues (DLQ)](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html), which other queues (source queues) can target for messages that can't be processed (consumed) successfully.<br/>- These messages can be replayed/redrived. <br/>- After [maxReceiveCount](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html), message would be pushed in the configured dead letter queue.                                              |
| In-flight Messages Limit                                                                                                              | [Messages are inflight](https://aws.amazon.com/premiumsupport/knowledge-center/sqs-message-backlog/) after they have been received from the queue by a consuming component, but have not yet been deleted from the queue.<br/>- Inflight messages limit - 120,000 for a standard queue, 20,000 for a FIFO queue.                                                                                                                                                                                                                                                         |
| [SQS Queue types - Standard vs FIFO](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/standard-queues.html) | [Amazon SQS]() offers two types of message queues - Standard & FIFO queues.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Message payload limit                                                                                                                 | Max message payload can be 256KB in SQS queue.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| [Batch Actions](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-batch-api-actions.html)                | Max 10 batches                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| [Short & long polling](https://aws.amazon.com/sqs/faqs/)                                                                              | Amazon SQS provides short polling and long polling to receive messages from a queue. <br/>- With short polling (default), Amazon SQS sends the response right away, even if the query found no messages. <br/>- With long polling, Amazon SQS sends a response after it collects at least one available message, up to the maximum number of messages specified in the request. Amazon SQS sends an empty response only if the polling wait time expires.<br/>- Using long polling can reduce the cost of using SQS because you can reduce the number of empty receives. |
| [Visibility Timeout](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-visibility-timeout.html)          | [Visibility timeout](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-visibility-timeout.html) is a period during which Amazon SQS prevents other consumers from receiving and processing a given message.                                                                                                                                                                                                                                                                                                                                 |
| [Delay queues](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-delay-queues.html)                      | [Delay queues](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-delay-queues.html) let you postpone the delivery of new messages to consumers for a number of seconds (known as [message timer](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-message-timers.html)), for example, when your consumer application needs additional time to process messages.<br/>- The maximum delay can be 15 minutes.                                                                                                    |
| Convert existing SQS standard queue to FIFO                                                                                           | You can't convert an existing standard queue into a FIFO queue. <br/>- To make the move, you must either create a new FIFO queue for your application or delete your existing standard queue and recreate it as a FIFO queue.                                                                                                                                                                                                                                                                                                                                            |

# SQS Queue types - Standard vs FIFO

|                                                   | [Standard Queues (Out-Of-Order, Recommended & Mostly-Used)](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/standard-queues.html)                                                                                                                                                                | [SQS FIFO queues](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/FIFO-queues.html)                                                                                                                                                                                                                           |
|---------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Throughput                                        | Unlimited Throughput                                                                                                                                                                                                                                                                                                        | High Throughput - Up to [300 messages per second](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/high-throughput-fifo.html). <br/>- Hence max 3000 messages per second with [allowed max 10 batches](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-batch-api-actions.html). |
| Delivery                                          | At-Least-Once Delivery                                                                                                                                                                                                                                                                                                      | [Exactly-Once Processing](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/FIFO-queues-exactly-once-processing.html)                                                                                                                                                                                           |
| Ordering                                          | Best-Effort Ordering                                                                                                                                                                                                                                                                                                        | [First-In-First-Out Delivery](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/FIFO-queues-message-order.html)                                                                                                                                                                                                 |
| Use Cases                                         | Decouple live user requests from intensive background work: Let users upload media while resizing or encoding it.<br/>- Allocate tasks to multiple worker nodes: Process a high number of credit card validation requests.<br/>- Batch messages for future processing: Schedule multiple entries to be added to a database. | Ensure that user-entered commands are executed in the right order.<br/>- Display the correct product price by sending price modifications in the right order.<br/>- Prevent a student from enrolling in a course before registering for an account.                                                                                      |
| Naming Convention (80-character queue name limit) | -                                                                                                                                                                                                                                                                                                                           | The name of a FIFO queue must end with the .fifo suffix.                                                                                                                                                                                                                                                                                                                                          |

# Amazon SQS Dead-letter queue

![img.png](assests/sqs/SQS-DLD-More-Info.png)

# Amazon SQS delay queues

![](https://docs.aws.amazon.com/images/AWSSimpleQueueService/latest/SQSDeveloperGuide/images/sqs-delay-queues-diagram.png)

# References
- [Amazon's SQS performance and latency](https://softwaremill.com/amazon-sqs-performance-latency/)
- [SQS vs SNS vs Amazon MQ - Comparison - AWS Certification Cheat Sheet](https://cloud.in28minutes.com/aws-certification-sqs-vs-sns-vs-amazon-mq)